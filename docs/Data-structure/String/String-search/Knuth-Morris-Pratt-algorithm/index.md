# Knuthâ€“Morrisâ€“Pratt algorithm

It takes me some effort to master KMP algorithm. Here are three articles that helped me solve the mystery as I learned. 

## Q&A

### æ ¸å¿ƒæ€æƒ³

ä¸€ã€è¿™ä¸ªç®—æ³•çš„æ€æƒ³åœ¨:

1ã€cnblogs [è¯¦è§£KMPç®—æ³•](https://www.cnblogs.com/yjiyjige/p/3263858.html) ä¸­æœ‰ç€å¾ˆå¥½çš„æè¿°:

> â€œ**åˆ©ç”¨å·²ç»éƒ¨åˆ†åŒ¹é…è¿™ä¸ªæœ‰æ•ˆä¿¡æ¯ï¼Œä¿æŒ`i`æŒ‡é’ˆä¸å›æº¯ï¼Œé€šè¿‡ä¿®æ”¹`j`æŒ‡é’ˆï¼Œè®©æ¨¡å¼ä¸²å°½é‡åœ°ç§»åŠ¨åˆ°æœ‰æ•ˆçš„ä½ç½®**ã€‚â€

æŒ‡é’ˆiä¸å›æº¯ï¼Œæ„å‘³ç€å®ƒæ˜¯ä¸€ç›´å¢å¤§çš„ã€‚

è¿™æ ·çš„åšæ³•èƒ½å¤Ÿä¿è¯è·³è¿‡æ— æ„ä¹‰çš„åŒ¹é…è¿‡ç¨‹ã€‚



2ã€ç™¾åº¦ç™¾ç§‘[kmpç®—æ³•](https://baike.baidu.com/item/kmp%E7%AE%97%E6%B3%95/10951804?fr=aladdin)ä¸­çš„æ€»ç»“ï¼š

> ç”¨æš´åŠ›ç®—æ³•åŒ¹é…å­—ç¬¦ä¸²è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šæŠŠ`T[0]` è·Ÿ `W[0]` åŒ¹é…ï¼Œå¦‚æœç›¸åŒåˆ™åŒ¹é…ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œç›´åˆ°å‡ºç°ä¸ç›¸åŒçš„æƒ…å†µï¼Œæ­¤æ—¶æˆ‘ä»¬ä¼šä¸¢å¼ƒå‰é¢çš„åŒ¹é…ä¿¡æ¯ï¼Œç„¶åæŠŠ`T[1]` è·Ÿ `W[0]`åŒ¹é…ï¼Œå¾ªç¯è¿›è¡Œï¼Œç›´åˆ°ä¸»ä¸²ç»“æŸï¼Œæˆ–è€…å‡ºç°åŒ¹é…æˆåŠŸçš„æƒ…å†µã€‚è¿™ç§ä¸¢å¼ƒå‰é¢çš„åŒ¹é…ä¿¡æ¯çš„æ–¹æ³•ï¼Œæå¤§åœ°é™ä½äº†åŒ¹é…æ•ˆç‡ã€‚
>
> è€Œåœ¨KMPç®—æ³•ä¸­ï¼Œå¯¹äºæ¯ä¸€ä¸ªæ¨¡å¼ä¸²æˆ‘ä»¬ä¼šäº‹å…ˆè®¡ç®—å‡ºæ¨¡å¼ä¸²çš„å†…éƒ¨åŒ¹é…ä¿¡æ¯ï¼Œåœ¨åŒ¹é…å¤±è´¥æ—¶æœ€å¤§çš„ç§»åŠ¨æ¨¡å¼ä¸²ï¼Œä»¥å‡å°‘åŒ¹é…æ¬¡æ•°ã€‚
>
> æ¯”å¦‚ï¼Œåœ¨ç®€å•çš„ä¸€æ¬¡åŒ¹é…å¤±è´¥åï¼Œæˆ‘ä»¬ä¼šæƒ³å°†æ¨¡å¼ä¸²å°½é‡çš„å³ç§»å’Œä¸»ä¸²è¿›è¡ŒåŒ¹é…ã€‚å³ç§»çš„è·ç¦»åœ¨KMPç®—æ³•ä¸­æ˜¯å¦‚æ­¤è®¡ç®—çš„ï¼šåœ¨**å·²ç»åŒ¹é…çš„æ¨¡å¼ä¸²å­ä¸²**ä¸­ï¼Œæ‰¾å‡ºæœ€é•¿çš„ç›¸åŒçš„[å‰ç¼€](https://baike.baidu.com/item/å‰ç¼€)å’Œ[åç¼€](https://baike.baidu.com/item/åç¼€)ï¼Œç„¶åç§»åŠ¨ä½¿å®ƒä»¬é‡å ã€‚



äºŒã€KMPç®—æ³•æ¶‰åŠä¸¤ä¸ªå­—ç¬¦ä¸²: `pattern`ã€`txt`ï¼Œå®ƒæœ¬èº«ä¹Ÿä½¿ç”¨äº†double pointer: firstã€second ï¼Œè¿™æ˜¯æ¶‰åŠä¸¤ä¸ªå­—ç¬¦ä¸²é—®é¢˜å¸¸ç”¨çš„å¥—è·¯ã€‚



### æ€è€ƒ: ä¸ºä»€ä¹ˆ**`i`æŒ‡é’ˆ**ä¸å›æº¯ä¾ç„¶èƒ½å¤Ÿä¿è¯æ‰¾åˆ°æ­£ç¡®çš„è§£ï¼Ÿ

éœ€è¦ç»“åˆå…·ä½“çš„ä¾‹å­æ¥è¿›è¡Œç†è§£:

ä¸€ã€example1 cnblogs [è¯¦è§£KMPç®—æ³•](https://www.cnblogs.com/yjiyjige/p/3263858.html) 

> å¦‚æœæ˜¯äººä¸ºæ¥å¯»æ‰¾çš„è¯ï¼Œè‚¯å®šä¸ä¼šå†æŠŠ`i`ç§»åŠ¨å›ç¬¬1ä½ï¼Œ**å› ä¸ºä¸»ä¸²åŒ¹é…å¤±è´¥çš„ä½ç½®å‰é¢é™¤äº†ç¬¬ä¸€ä¸ª`A`ä¹‹å¤–å†ä¹Ÿæ²¡æœ‰`A`**äº†ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆèƒ½çŸ¥é“ä¸»ä¸²å‰é¢åªæœ‰ä¸€ä¸ª`A`ï¼Ÿ**å› ä¸ºæˆ‘ä»¬å·²ç»çŸ¥é“å‰é¢ä¸‰ä¸ªå­—ç¬¦éƒ½æ˜¯åŒ¹é…çš„ï¼ï¼ˆè¿™å¾ˆé‡è¦ï¼‰**ã€‚ç§»åŠ¨è¿‡å»è‚¯å®šä¹Ÿæ˜¯ä¸åŒ¹é…çš„ï¼æœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œ`i`å¯ä»¥ä¸åŠ¨ï¼Œæˆ‘ä»¬åªéœ€è¦ç§»åŠ¨`j`å³å¯ï¼Œå¦‚ä¸‹å›¾ï¼š
>
>  ![img](https://images0.cnblogs.com/blog/416010/201308/17083828-cdb207f5460f4645982171e58571a741.png)

patternå’Œtxtä¸­å·²ç»åŒ¹é…çš„å†…å®¹å…¶å®å°±æ˜¯patternçš„ä¸€éƒ¨åˆ†ï¼Œ"**å› ä¸ºä¸»ä¸²åŒ¹é…å¤±è´¥çš„ä½ç½®å‰é¢é™¤äº†ç¬¬ä¸€ä¸ª`A`ä¹‹å¤–å†ä¹Ÿæ²¡æœ‰`A`**äº†" è¿™æ˜¯å¯ä»¥é€šè¿‡é¢„å¤„ç†patternæ¥å®ç°çš„ï¼Œç®€è€Œè¨€ä¹‹ï¼Œä»…ä»…æ ¹æ®å·²ç»åŒ¹é…çš„éƒ¨åˆ†å°±èƒ½å¤ŸçŸ¥é“ `j` æŒ‡é’ˆçš„è½¬ç§»ï¼Œä»è€Œé¿å…å¾ˆå¤šæ— æ•ˆçš„åŒ¹é…ã€‚



### å¦‚ä½•ç†è§£å…¬å…±å‰ç¼€åç¼€

å¦‚æœä¸€ä¸ªå­—ç¬¦ï¼Œå®ƒæ²¡æœ‰å…¬å…±å‰ç¼€ï¼Œé‚£ä¹ˆè¯´æ˜å®ƒåœ¨å‰é¢å°±æ²¡æœ‰å‡ºç°è¿‡ã€‚



### å½“patternçš„æœ€åä¸€ä¸ªå­—ç¬¦å¤±é…æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ

```
aaacaaab
aaab
```



```
ABCDABE
ABCDABF
```



### KMP failure/next function/array and DFA

ä¸€ã€Failure arrayä»¥arrayçš„æ–¹å¼éå¸¸ç´§å‡‘åœ°æ¥å­˜å‚¨DFAï¼Œå®ƒçš„DFAçš„å®Œæ•´å½¢å¼åœ¨ zhihu [KMP ç®—æ³•è¯¦è§£](https://zhuanlan.zhihu.com/p/83334559) ä¸­æœ‰å±•ç¤ºã€‚



äºŒã€æ˜ç¡®æ•°ç»„çš„å®šä¹‰:

`next[i]` è¡¨ç¤ºçš„æ˜¯: æœ€é•¿å…¬å…±å‰ç¼€åç¼€çš„é•¿åº¦( `k` )ï¼Œå› æ­¤åœ¨è®¡ç®—failure arrayçš„æ—¶å€™æ˜¯æ¶‰åŠåˆ°é•¿åº¦å’Œä¸‹æ ‡çš„è½¬æ¢çš„ã€‚



ä¸‰ã€è®¡ç®— next/failure array çš„è¿‡ç¨‹å…¶å®ä¸åŒ¹é… `txt` å’Œ `pattern` çš„è¿‡ç¨‹éå¸¸ç±»ä¼¼: å¯»æ‰¾æœ€é•¿å…¬å…±**å‰ç¼€**å’Œ**åç¼€**å…¶å®å°±æ˜¯åŒ¹é…**å‰ç¼€å­å­—ç¬¦ä¸²** å’Œ **åç¼€å­å­—ç¬¦ä¸²**ï¼Œ**å‰ç¼€å­å­—ç¬¦ä¸²**ç›¸å½“äº`pattern`ï¼Œ**åç¼€å­å­—ç¬¦ä¸²** ç›¸å½“äº `txt`ï¼Œä¸‹é¢çš„å›¾å°±éå¸¸å½¢è±¡åœ°å±•ç¤ºäº†è¿™ä¸ªè¿‡ç¨‹ï¼Œè¿™å°±å‘Šè¯‰æˆ‘ä»¬åœ¨è®¡ç®— next/failure array çš„æ—¶å€™ï¼Œæ˜¯å¯ä»¥ä½¿ç”¨kmpçš„æ€æƒ³æ¥è¿›è¡Œå®ç°çš„:

1ã€å½“ `pattern[k]` å’Œ `pattern[j]` ç›¸ç­‰çš„æ—¶å€™:

> è¿™ç§æƒ…å†µæ˜¯éå¸¸å®¹æ˜“ç†è§£çš„



2ã€å½“ `pattern[k]` å’Œ `pattern[j]` ä¸ç›¸ç­‰çš„æ—¶å€™:

> å½“`P[k] != P[j]`æ—¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
>
> ![img](./17122358-fd7e52dd382c4268a8ff52b85bff465d.png) 
>
> 
>
> åƒè¿™ç§æƒ…å†µï¼Œå¦‚æœä½ ä»ä»£ç ä¸Šçœ‹åº”è¯¥æ˜¯è¿™ä¸€å¥ï¼š`k = next[k];`ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·å­ï¼Ÿä½ çœ‹ä¸‹é¢åº”è¯¥å°±æ˜ç™½äº†ã€‚
>
>  ![img](./17122439-e349fed25e974e7886a27d18871ae48a.png)
>
> ç°åœ¨ä½ åº”è¯¥çŸ¥é“ä¸ºä»€ä¹ˆè¦`k = next[k]`äº†å§ï¼åƒä¸Šè¾¹çš„ä¾‹å­ï¼Œæˆ‘ä»¬å·²ç»ä¸å¯èƒ½æ‰¾åˆ°`[ Aï¼ŒBï¼ŒAï¼ŒB ]`è¿™ä¸ªæœ€é•¿çš„åç¼€ä¸²äº†ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯å¯èƒ½æ‰¾åˆ°`[ Aï¼ŒB ]`ã€`[ A ]`è¿™æ ·çš„å‰ç¼€ä¸²çš„ã€‚æ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹åƒä¸åƒåœ¨å®šä½`[ Aï¼ŒBï¼ŒAï¼ŒC ]`è¿™ä¸ªä¸²ï¼Œå½“`C`å’Œä¸»ä¸²ä¸ä¸€æ ·äº†ï¼ˆä¹Ÿå°±æ˜¯`k`ä½ç½®ä¸ä¸€æ ·äº†ï¼‰ï¼Œé‚£å½“ç„¶æ˜¯æŠŠæŒ‡é’ˆç§»åŠ¨åˆ°`next[k]`å•¦ã€‚



ä¸Šè¿°ç¬¬äºŒè¡Œçš„å›¾ï¼Œå°±æ˜¯ä»¥"KMPåŒ¹é…" çš„è¿‡ç¨‹æ¥å±•ç¤ºè®¡ç®— next/failure array çš„è¿‡ç¨‹: 

å½“  `P[k] != P[j]`ï¼Œæ˜¾ç„¶å°±æ˜¯å¤±é…äº†ï¼Œå› æ­¤ `[ Aï¼ŒBï¼ŒAï¼ŒB ]` ä¸å¯èƒ½æ˜¯æœ€é•¿çš„åç¼€ä¸²ï¼Œé‚£ä¸‹æ¬¡ä»ä»€ä¹ˆåœ°æ–¹å¼€å§‹åŒ¹é…å‘¢ï¼Ÿå³å¦‚ä½•è¿›è¡Œè½¬ç§»å‘¢ï¼Ÿæ˜¾ç„¶è¿™ä¸ªåŒ¹é…è¿‡ç¨‹æ˜¯å¯ä»¥è½¬æ¢ä¸º"KMPåŒ¹é…"è¿‡ç¨‹ï¼Œæ­£å¦‚ä¸Šè¿°ç¬¬äºŒè¡Œçš„å›¾æ‰€å±•ç¤ºçš„ï¼Œæ˜¾ç„¶æˆ‘ä»¬è¦å……åˆ†è¿ç”¨KMPçš„æ€æƒ³: æ­¤æ—¶ `[0-k-1]`éƒ¨åˆ† å’Œ `[j-k, j-1]`éƒ¨åˆ†æ˜¯å·²ç»åŒ¹é…çš„ï¼Œä¸ºäº†å……åˆ†è¿ç”¨å·²ç»åŒ¹é…çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬åº”è¯¥è½¬ç§»åˆ° `next[k]` å¤„è¿›è¡ŒåŒ¹é…ï¼Œå°±æ˜¯ä¸Šè¿°ç¬¬ä¸‰å¼ å›¾æ‰€å±•ç¤ºçš„ã€‚ä¸Šè¿°è¿‡ç¨‹å…¶å®ä½¿ç”¨äº†KMPçš„æ€æƒ³ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è®¡ç®—next/failure arrayçš„æ—¶å€™ï¼Œå…¶å®ä¹Ÿä½¿ç”¨äº†KMPçš„æ€æƒ³ã€‚



å…³äºè¿™ä¸€ç‚¹ï¼Œå¦å¤–ä¸€ç§éªŒè¯æ–¹å¼æ˜¯é€šè¿‡ä»£ç æ¥è¿›è¡ŒéªŒè¯ï¼Œé˜…è¯»å®Œæ•´çš„KMPç®—æ³•å¯çŸ¥: `get_failure_array` å’Œ `kmp_search` åœ¨å¤±é…æ—¶çš„å¤„ç†é€»è¾‘ä¸€æ¨¡ä¸€æ ·ã€‚



å››ã€è®¡ç®—failure arrayçš„è¿‡ç¨‹æ˜¯KMPç®—æ³•çš„ç²¾å¦™ä¹‹å¤„ï¼Œå®ƒæ¶‰åŠ:

1ã€å½“ **åŒ¹é…** çš„æ—¶å€™: å‘å‰ã€expand

2ã€å½“ **å¤±é…** çš„æ—¶å€™: å‘åã€reduce

äº”ã€åœ¨ cnblogs [è¯¦è§£KMPç®—æ³•](https://www.cnblogs.com/yjiyjige/p/3263858.html) ä¸­ä½¿ç”¨æ•°å­¦è¯­è¨€æ¥è¿›è¡Œå®šä¹‰ã€‚



å…­ã€ç®—æ³•æ€æƒ³:

1ã€double pointer

2ã€dynamic programmingã€recursion

KMPçš„failure functionçš„æ±‚è§£è¿‡ç¨‹åœ¨è®¡ç®—`f(k+1)`çš„æ—¶æ‰€ä¾èµ–çš„`f(0),f(1)...,f(k)`éƒ½æ˜¯é€šè¿‡æŸ¥failure tableè€Œè·å¾—çš„ï¼Œè€Œä¸æ˜¯é‡æ–°è®¡ç®—ï¼Œè¿™å…¶å®å°±æ˜¯åŠ¨æ€è§„åˆ’ç®—æ³•çš„æ€æƒ³ã€‚åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ`i`å°±è¡¨ç¤ºè®¡ç®—`f(k+1)`æ‰€ä¾èµ–çš„æ•°æ®ï¼Œå®ƒçš„å®ç°æ–¹å¼æ˜¯éå¸¸ç±»ä¼¼äºè¿­ä»£ç‰ˆçš„æ–æ³¢é‚£å¥‘æ•°åˆ—ã€‚

#### Pythonå®ç°

ä¸€ã€failure function `f(j)`è¡¨ç¤ºçš„æ˜¯ä» `pattern[0-j]` çš„åºåˆ—ï¼ˆæ˜¾ç„¶è¿™ä¸ªåºåˆ—çš„é•¿åº¦æ˜¯`j+1`ï¼‰çš„**æœ€é•¿å…¬å…±å‰ç¼€åç¼€**çš„**é•¿åº¦**ï¼Œå³`f(j)`æ‰€è¡¨ç¤ºçš„æ˜¯é•¿åº¦ä¸º`j+1`çš„åºåˆ—çš„æœ€é•¿å…¬å…±å‰ç¼€åç¼€çš„é•¿åº¦ã€‚

base case: `f[0]==0`ï¼Œå› ä¸ºé•¿åº¦ä¸º1çš„åºåˆ—çš„æœ€é•¿å‰ç¼€åç¼€çš„é•¿åº¦ä¸º0ã€‚

äºŒã€åœ¨è¿™ä¸ªç¨‹åºä¸­ï¼Œ`i`è¡¨ç¤º"å…¬å…±å‰ç¼€å­å­—ç¬¦ä¸²çš„é•¿åº¦"ï¼Œæ ¹æ®é•¿åº¦å’Œä¸‹æ ‡çš„å¯¹åº”å…³ç³»å¯çŸ¥ï¼Œ`i`å§‹ç»ˆæŒ‡å‘çš„æ˜¯ **ä¸‹ä¸€ä¸ªå¾…åŒ¹é…çš„å­—ç¬¦** ã€‚

ä¸‰ã€è¯¥ç®—æ³•æ˜¯å…¸å‹çš„fast-slow double pointerï¼Œ`i` æ˜¯ slow pointerï¼Œ`j` æ˜¯ fast pointerï¼Œä¸æ­¤ç±»ä¼¼çš„ä½¿ç”¨fast-slow double pointeræ¥å¤„ç†arrayçš„algorithmï¼Œåœ¨ä¸‹é¢çš„æ–‡ç« ä¸­æœ‰ä»‹ç»ï¼š

1ã€labuladong [å¦‚ä½•é«˜æ•ˆå¯¹æœ‰åºæ•°ç»„/é“¾è¡¨å»é‡ï¼Ÿ](https://mp.weixin.qq.com/s/6Eb7gKqNqXH9B0hSZvMs5A)

2ã€labuladong  [åŒæŒ‡é’ˆæŠ€å·§ç§’æ€å››é“æ•°ç»„/é“¾è¡¨é¢˜ç›®](https://mp.weixin.qq.com/s/55UPwGL0-Vgdh8wUEPXpMQ)

```python

def get_failure_array(pattern: str):
    """

    """
    failure_array = [0]  # failure arrayï¼Œf[0]å·²çŸ¥
    i = 0  # iè¡¨ç¤ºçš„æ˜¯å½“å‰çš„å…¬å…±å‰åç¼€çš„é•¿åº¦ï¼Œå½“å‰jä¸º0ï¼Œæ‰€ä»¥å®ƒçš„åˆå§‹å€¼æ˜¯0
    j = 1  # jè¡¨ç¤ºçš„æ˜¯indexï¼Œå› ä¸ºf[0]å·²çŸ¥ï¼Œæ‰€ä»¥jä»1å¼€å§‹
    while j < len(pattern):
        if pattern[i] == pattern[j]:
            i += 1
        elif i > 0:  # å¤±é…
            i = failure_array[i - 1] # æ‹¿åˆ°å·²ç»åŒ¹é…éƒ¨åˆ†[0~i-1]çš„å…¬å…±å‰ç¼€åç¼€çš„é•¿åº¦
            continue
        j += 1
        failure_array.append(i)
    return failure_array

```





#### Examples



Example1

```
Position:    012345
P:           abacab
```

| 0    | 1    | 2    | 3    | 4    | 5    |
| ---- | ---- | ---- | ---- | ---- | ---- |
| 0    | 0    | 1    | 0    | 1    | 2    |



Example2

```
Position:    012345678
P:           ababcabab
```

| 0    | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 0    | 0    | 1    | 2    | 0    | 1    | 2    | 3    | 4    |



Example3

```
Position:    012345678
P:           ababcabab
```

| 0    | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 0    | 0    | 1    | 2    | 0    | 1    | 2    | 3    | 4    |



Example3

```
Position:    0123456789
P:           ABACDABABC
```

| 0    | 1    | 2    | 3        | 4    | 5    | 6    | 7    | 8    | 9    |
| ---- | ---- | ---- | -------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 0    | 0    | 1    | f(1)=0;0 | 0    | 1    | 2    | 3    | 2    | 0    |

è¿™ä¸ªä¾‹å­éå¸¸å¥½ã€‚

### Source code

#### Python

```python

def get_failure_array(pattern: str):
    failure = [0]  # åˆå§‹æ¡ä»¶
    i = 0  
    j = 1  
    while j < len(pattern):
        if pattern[i] == pattern[j]:
            i += 1
        elif i > 0:
            i = failure[i - 1]
            continue
        j += 1
        failure.append(i)
    return failure


def kmp_search(pattern: str, text: str):
    """

    :param pattern:
    :param text:
    :return:
    """
    # 1) Construct the failure array
    failure = get_failure_array(pattern)

    # 2) Step through text searching for pattern
    i, j = 0, 0  # index into text, pattern
    while i < len(text):
        if pattern[j] == text[i]:
            if j == (len(pattern) - 1):
                return True
            j += 1
        elif j > 0:
            # if this is a prefix in our pattern
            # just go back far enough to continue
            j = failure[j - 1]
            continue
        i += 1
    return False


if __name__ == "__main__":
    pass

```



#### C++

```c++

class Solution
{
public:
  int strStr(string haystack, string needle)
  {
    if (needle.empty())
    {
      return 0;
    }
    else
    {
      return kmp(haystack, needle);
    }
  }
  int kmp(const string &haystack, const string &needle)
  {
    auto failureArray = getFailureArray(needle);
    int i = 0, j = 0;
    while (i < haystack.size())
    {
      if (haystack[i] == needle[j])
      {
        if (j == needle.size() - 1)
        {
          return i - j;
        }
        ++j;
      }
      else if (j > 0)
      {
        j = failureArray[j - 1];
        continue;
      }
      ++i;
    }
    return -1;
  }
  std::vector<int> getFailureArray(const string &needle)
  {
    std::vector<int> failureArray(needle.size());
    int i = 0, j = 1;
    while (j < needle.size())
    {
      if (needle[i] == needle[j])
      {
        ++i;
      }
      else if (i > 0)
      {
        i = failureArray[i - 1];
        continue;
      }
      failureArray[j++] = i;
    }
    return failureArray;
  }
};
```





## cnblogs [è¯¦è§£KMPç®—æ³•](https://www.cnblogs.com/yjiyjige/p/3263858.html) 

KMPç®—æ³•è¦è§£å†³çš„é—®é¢˜å°±æ˜¯åœ¨å­—ç¬¦ä¸²ï¼ˆä¹Ÿå«ä¸»ä¸²ï¼‰ä¸­çš„æ¨¡å¼ï¼ˆpatternï¼‰å®šä½é—®é¢˜ã€‚è¯´ç®€å•ç‚¹å°±æ˜¯æˆ‘ä»¬å¹³æ—¶å¸¸è¯´çš„å…³é”®å­—æœç´¢ã€‚æ¨¡å¼ä¸²å°±æ˜¯å…³é”®å­—ï¼ˆæ¥ä¸‹æ¥ç§°å®ƒä¸º`P`ï¼‰ï¼Œå¦‚æœå®ƒåœ¨ä¸€ä¸ªä¸»ä¸²ï¼ˆæ¥ä¸‹æ¥ç§°ä¸º`T`ï¼‰ä¸­å‡ºç°ï¼Œå°±è¿”å›å®ƒçš„å…·ä½“ä½ç½®ï¼Œå¦åˆ™è¿”å›`-1`ï¼ˆå¸¸ç”¨æ‰‹æ®µï¼‰ã€‚

 ![img](https://images0.cnblogs.com/blog/416010/201308/17083616-9b40c67ea22e449f813fb38fcfd3a4fb.png)



### Native algorithm

é¦–å…ˆï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜æœ‰ä¸€ä¸ªå¾ˆå•çº¯çš„æƒ³æ³•ï¼šä»å·¦åˆ°å³ä¸€ä¸ªä¸ªåŒ¹é…ï¼Œå¦‚æœè¿™ä¸ªè¿‡ç¨‹ä¸­æœ‰æŸä¸ªå­—ç¬¦ä¸åŒ¹é…ï¼Œå°±è·³å›å»ï¼Œå°†æ¨¡å¼ä¸²å‘å³ç§»åŠ¨ä¸€ä½ã€‚è¿™æœ‰ä»€ä¹ˆéš¾çš„ï¼Ÿ

æˆ‘ä»¬å¯ä»¥è¿™æ ·åˆå§‹åŒ–ï¼š

 ![img](https://images0.cnblogs.com/blog/416010/201308/17083647-9dfd3e4a709c40dd98d9817927651960.png)

ä¹‹åæˆ‘ä»¬åªéœ€è¦æ¯”è¾ƒ**`i`æŒ‡é’ˆ**æŒ‡å‘çš„å­—ç¬¦å’Œ**`j`æŒ‡é’ˆ**æŒ‡å‘çš„å­—ç¬¦æ˜¯å¦ä¸€è‡´ã€‚å¦‚æœä¸€è‡´å°±éƒ½å‘åç§»åŠ¨ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œå¦‚ä¸‹å›¾ï¼š

![img](https://images0.cnblogs.com/blog/416010/201308/17083659-e6718026bf4f48a0be2d5d6076be4c55.png) 

 

`A`å’Œ`E`ä¸ç›¸ç­‰ï¼Œé‚£å°±æŠŠ**`i`æŒ‡é’ˆ**ç§»å›ç¬¬1ä½ï¼ˆå‡è®¾ä¸‹æ ‡ä»0å¼€å§‹ï¼‰ï¼Œ`j`ç§»åŠ¨åˆ°æ¨¡å¼ä¸²çš„ç¬¬0ä½ï¼Œç„¶ååˆé‡æ–°å¼€å§‹è¿™ä¸ªæ­¥éª¤ï¼š

 ![img](https://images0.cnblogs.com/blog/416010/201308/17083714-7de56d2c1cc84dbfa376cf410ba6f053.png)

åŸºäºè¿™ä¸ªæƒ³æ³•æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹çš„ç¨‹åºï¼š

```java
/**
 * æš´åŠ›ç ´è§£æ³•
 * @param ts ä¸»ä¸²
 * @param ps æ¨¡å¼ä¸²
 * @return å¦‚æœæ‰¾åˆ°ï¼Œè¿”å›åœ¨ä¸»ä¸²ä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦å‡ºç°çš„ä¸‹æ ‡ï¼Œå¦åˆ™ä¸º-1
 */
public static int bf(String ts, String ps) {
    char[] t = ts.toCharArray();
    char[] p = ps.toCharArray();

    int i = 0; // ä¸»ä¸²çš„ä½ç½®
    int j = 0; // æ¨¡å¼ä¸²çš„ä½ç½®

    while (i < t.length && j < p.length) {
       if (t[i] == p[j]) { // å½“ä¸¤ä¸ªå­—ç¬¦ç›¸åŒï¼Œå°±æ¯”è¾ƒä¸‹ä¸€ä¸ª
           i++;
           j++;
       } else {
           i = i - j + 1; // ä¸€æ—¦ä¸åŒ¹é…ï¼Œiåé€€
           j = 0; // jå½’0
       }
    }

    if (j == p.length) {
       return i - j;
    } else {
       return -1;
    }
}
```

ä¸Šé¢çš„ç¨‹åºæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†ä¸å¤Ÿå¥½ï¼

> NOTE: 
>
> ä¸€ã€geeksforgeeks [Naive algorithm for Pattern Searching](https://www.geeksforgeeks.org/naive-algorithm-for-pattern-searching/) ä¸­ç»™å‡ºçš„ä»£ç æ˜¯æ¯”ä¸Šè¿°ä»£ç æ›´åŠ å®¹æ˜“ç†è§£çš„ã€‚ 
>
> äºŒã€ä¸Šè¿°ç¨‹åºæ˜¯å…¸å‹çš„double pointer: first+second



å¦‚æœæ˜¯äººä¸ºæ¥å¯»æ‰¾çš„è¯ï¼Œè‚¯å®šä¸ä¼šå†æŠŠ`i`ç§»åŠ¨å›ç¬¬1ä½ï¼Œ**å› ä¸ºä¸»ä¸²åŒ¹é…å¤±è´¥çš„ä½ç½®å‰é¢é™¤äº†ç¬¬ä¸€ä¸ª`A`ä¹‹å¤–å†ä¹Ÿæ²¡æœ‰`A`**äº†ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆèƒ½çŸ¥é“ä¸»ä¸²å‰é¢åªæœ‰ä¸€ä¸ª`A`ï¼Ÿ**å› ä¸ºæˆ‘ä»¬å·²ç»çŸ¥é“å‰é¢ä¸‰ä¸ªå­—ç¬¦éƒ½æ˜¯åŒ¹é…çš„ï¼ï¼ˆè¿™å¾ˆé‡è¦ï¼‰**ã€‚ç§»åŠ¨è¿‡å»è‚¯å®šä¹Ÿæ˜¯ä¸åŒ¹é…çš„ï¼æœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œ`i`å¯ä»¥ä¸åŠ¨ï¼Œæˆ‘ä»¬åªéœ€è¦ç§»åŠ¨`j`å³å¯ï¼Œå¦‚ä¸‹å›¾ï¼š

 ![img](https://images0.cnblogs.com/blog/416010/201308/17083828-cdb207f5460f4645982171e58571a741.png)

> NOTE: 
>
> ä¸€ã€æ˜¾ç„¶ä¸Šé¢è¿™ç§åŒ¹é…æ–¹å¼èƒ½å¤Ÿè·³è¿‡å¾ˆå¤šçš„æ— æ„ä¹‰çš„åŒ¹é…ï¼Œå› ä¸º `txt` åŒ¹é…å¤±è´¥çš„éƒ¨åˆ†æ²¡æœ‰Aï¼Œæœ€ä¸ºå¯¹æ¯”ï¼Œå¯ä»¥å¯ä»¥å°è¯•ä½¿ç”¨nativeç®—æ³•è¿›è¡ŒåŒ¹é…ï¼Œå¯ä»¥å‘ç°æ˜¯ä¼šè¿›è¡Œå¾ˆå¤šæ— æ„ä¹‰çš„åŒ¹é…ã€‚
>
> äºŒã€è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„è¯´æ˜iæŒ‡é’ˆä¸éœ€è¦å›æº¯çš„ä¾‹å­ï¼Œå½“å¤±é…çš„æ—¶å€™ï¼Œ`i` æŒ‡é’ˆæ˜¯ä¸éœ€è¦ç§»åŠ¨çš„ï¼Œä»…ä»…ç§»åŠ¨ `j` æŒ‡é’ˆå³å¯ã€‚

ä¸Šé¢çš„è¿™ç§æƒ…å†µè¿˜æ˜¯æ¯”è¾ƒç†æƒ³çš„æƒ…å†µï¼Œæˆ‘ä»¬æœ€å¤šä¹Ÿå°±å¤šæ¯”è¾ƒäº†ä¸¤æ¬¡ã€‚ä½†å‡å¦‚æ˜¯åœ¨ä¸»ä¸²`SSSSSSSSSSSSSA`ä¸­æŸ¥æ‰¾`SSSSB`ï¼Œæ¯”è¾ƒåˆ°æœ€åä¸€ä¸ªæ‰çŸ¥é“ä¸åŒ¹é…ï¼Œç„¶å`i`**å›æº¯**ï¼Œè¿™ä¸ªçš„æ•ˆç‡æ˜¯æ˜¾ç„¶æ˜¯æœ€ä½çš„ã€‚

> NOTE: 
>
> ä¸€ã€å…³äºå›æº¯ï¼Œå‚è§[Backtracking](https://en.wikipedia.org/wiki/Backtracking)

### KMPç®—æ³•

å¤§ç‰›ä»¬æ˜¯æ— æ³•å¿å—â€œæš´åŠ›ç ´è§£â€è¿™ç§ä½æ•ˆçš„æ‰‹æ®µçš„ï¼Œäºæ˜¯ä»–ä»¬ä¸‰ä¸ªç ”ç©¶å‡ºäº†KMPç®—æ³•ã€‚å…¶æ€æƒ³å°±å¦‚åŒæˆ‘ä»¬ä¸Šè¾¹æ‰€çœ‹åˆ°çš„ä¸€æ ·ï¼šâ€œ**åˆ©ç”¨å·²ç»éƒ¨åˆ†åŒ¹é…è¿™ä¸ªæœ‰æ•ˆä¿¡æ¯ï¼Œä¿æŒ`i`æŒ‡é’ˆä¸å›æº¯ï¼Œé€šè¿‡ä¿®æ”¹`j`æŒ‡é’ˆï¼Œè®©æ¨¡å¼ä¸²å°½é‡åœ°ç§»åŠ¨åˆ°æœ‰æ•ˆçš„ä½ç½®**ã€‚â€

> NOTE: 
>
> ä¸€ã€ä¸Šé¢è¿™æ®µè¯ä½¿ç”¨äº† "**å°½é‡åœ°**" ä¿®é¥°è¯­ï¼Œç­‰ä½ å®Œå…¨ç†è§£äº†KMPç®—æ³•ï¼Œä½ å°±å¹¡ç„¶é†’æ‚Ÿè¿™ä¸ªä¿®é¥°è¯­æ˜¯éå¸¸å¦™çš„: æ—¢ç„¶è¯´æ˜¯å°½é‡ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ç§»åŠ¨åˆ°çš„ä½ç½®ä¸ä¸€å®šæ˜¯æœ€æœ€æœ‰æ•ˆçš„ä½ç½®ï¼Œè€Œæ˜¯ä¸€ä¸ªç›¸å¯¹æœ‰æ•ˆçš„ä½ç½®ï¼Œå¯èƒ½éœ€è¦ç»è¿‡å¤šæ¬¡ç§»åŠ¨æ‰èƒ½å¤Ÿåˆ°è¾¾æ­£ç¡®çš„ä½ç½®ï¼Œæ¯•ç«Ÿè®¡ç®—æœºä¸æ˜¯åƒæˆ‘ä»¬äººè¿™æ ·çš„æ™ºèƒ½ã€‚

æ‰€ä»¥ï¼Œæ•´ä¸ªKMPçš„é‡ç‚¹å°±åœ¨äº**å½“æŸä¸€ä¸ªå­—ç¬¦ä¸ä¸»ä¸²ä¸åŒ¹é…æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥çŸ¥é“`j`æŒ‡é’ˆè¦ç§»åŠ¨åˆ°å“ª**ï¼Ÿ



#### Example 1

æ¥ä¸‹æ¥æˆ‘ä»¬è‡ªå·±æ¥å‘ç°`j`çš„ç§»åŠ¨è§„å¾‹ï¼š

 ![img](https://images0.cnblogs.com/blog/416010/201308/17083912-49365b7e67cd4877b2f501074dae68d2.png)

å¦‚å›¾ï¼š`C`å’Œ`D`ä¸åŒ¹é…äº†ï¼Œæˆ‘ä»¬è¦æŠŠ`j`ç§»åŠ¨åˆ°å“ªï¼Ÿæ˜¾ç„¶æ˜¯ç¬¬1ä½ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå‰é¢æœ‰ä¸€ä¸ª`A`ç›¸åŒå•Šï¼š

![img](https://images0.cnblogs.com/blog/416010/201308/17083929-a9ccfb08833e4cf1a42c30f05608f8f5.png)

> NOTE:
>
> ä¸€ã€ä½œä¸ºå¯¹æ¯”ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨nativeç®—æ³•è¿›è¡ŒåŒ¹é…ï¼Œæ˜¾ç„¶ `txt[1]` å’Œ `pattern[0]` æ˜¯ä¸åŒ¹é…çš„ï¼Œæ˜¾ç„¶è¿™æ˜¯æ— æ„ä¹‰çš„åŒ¹é…ï¼›æ ¹æ®å…¬å…±å‰ç¼€åç¼€ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯çŸ¥: `txt[2]` å’Œ `pattern[0]` æ˜¯åŒ¹é…çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ®æ­¤å¯ä»¥å°†jæŒ‡é’ˆç§»åˆ°1å¤„ã€‚

#### Example 2

å¦‚ä¸‹å›¾ä¹Ÿæ˜¯ä¸€æ ·çš„æƒ…å†µï¼š 

![img](https://images0.cnblogs.com/blog/416010/201308/17084030-82e4b71b85a440c5a636d57503931415.png)

å¯ä»¥æŠŠ`j`æŒ‡é’ˆç§»åŠ¨åˆ°ç¬¬2ä½ï¼Œå› ä¸ºå‰é¢æœ‰ä¸¤ä¸ªå­—æ¯æ˜¯ä¸€æ ·çš„ï¼š

 ![img](https://images0.cnblogs.com/blog/416010/201308/17084037-cc3c34200809414e9421c316ceba2cda.png)



#### Example 3

```
ABCAD
ABCAE
```

æ˜¾ç„¶å½“`j=4,i=4`æ—¶ä¸¤è€…å¤±é…ï¼Œé‚£æ­¤äº‹`j`è½¬ç§»åˆ°å“ªé‡Œå‘¢ï¼Ÿæ˜¾ç„¶è¦è½¬ç§»åˆ°`1`ã€‚è¿™æ˜¯å’Œä¸‹é¢çš„ç»“è®ºæœ‰å‡ºå…¥çš„ã€‚

```
ABCDABE
ABCDABF
```

#### Example 4

```
aaacaaab
aaab
```



#### ç»“è®º

> NOTE:
>
> ä¸€ã€éœ€è¦æ³¨æ„çš„æ˜¯: åŸæ–‡çš„ä¾‹å­èƒŒæ™¯ç‰¹æ®Šï¼Œéƒ½æ˜¯å…¬å…±å‰ç¼€å’Œå…¬å…±åç¼€ä¹‹é—´ä»…ä»…ç›¸éš”ä¸€ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒæ˜¯å…è®¸ç›¸éš”å¤šä¸ªå­—ç¬¦çš„ï¼Œä½œè€…çš„è¡¨è¿°å…¶å®æ˜¯æ¯”è¾ƒç²¾å‡†çš„ï¼Œä¸è¿‡åˆæ¬¡æ¥è§¦çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šè¢«å›¾æ‰€è¿·æƒ‘ã€‚
>
> äºŒã€`k`å¦‚ä½•ç†è§£å‘¢ï¼Ÿ
>
> 1ã€è¡¨ç¤ºçš„æ˜¯å…¬å…±å‰ç¼€å…¬å…±åç¼€çš„é•¿åº¦
>
> 2ã€`j` ç§»åŠ¨çš„ä½ç½®
>
> 

è‡³æ­¤æˆ‘ä»¬å¯ä»¥å¤§æ¦‚çœ‹å‡ºä¸€ç‚¹ç«¯å€ªï¼Œå½“åŒ¹é…å¤±è´¥æ—¶ï¼Œ`j`è¦ç§»åŠ¨çš„ä¸‹ä¸€ä¸ªä½ç½®`k`ã€‚å­˜åœ¨ç€è¿™æ ·çš„æ€§è´¨ï¼š**æœ€å‰é¢çš„`k`å­—ç¬¦å’Œ`j`ä¹‹å‰çš„æœ€å`k`ä¸ªå­—ç¬¦æ˜¯ä¸€æ ·çš„**ã€‚

å¦‚æœç”¨æ•°å­¦å…¬å¼æ¥è¡¨ç¤ºæ˜¯è¿™æ ·çš„

`P[0 ~ k-1] == P[j-k ~ j-1]`

> NOTE: 
>
> ä¸€ã€ä¸Šé¢æ˜¯ä½¿ç”¨æ•°å­¦è¯­è¨€æ¥æè¿°å…¬å…±å‰ç¼€å’Œå…¬å…±åç¼€
>
> äºŒã€`j-1` è¡¨ç¤ºçš„å°±æ˜¯ä¸Šè¿°è‡ªç„¶è¯­è¨€ä¸­çš„ "**`j`ä¹‹å‰çš„**"

è¿™ä¸ªç›¸å½“é‡è¦ï¼Œå¦‚æœè§‰å¾—ä¸å¥½è®°çš„è¯ï¼Œå¯ä»¥é€šè¿‡ä¸‹å›¾æ¥ç†è§£ï¼š

 ![img](https://images0.cnblogs.com/blog/416010/201308/17084056-66930855432b4357bafbf8d6c76c1840.png)

å¼„æ˜ç™½äº†è¿™ä¸ªå°±åº”è¯¥å¯èƒ½æ˜ç™½ä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥å°†`j`ç§»åŠ¨åˆ°`k`ä½ç½®äº†ã€‚

å› ä¸º:

å½“`T[i] != P[j]`æ—¶

æœ‰`T[i-j ~ i-1] == P[0 ~ j-1]`

ç”±`P[0 ~ k-1] == P[j-k ~ j-1]`

å¿…ç„¶ï¼š`T[i-k ~ i-1] == P[0 ~ k-1]`

> NOTE: ä¸Šè¿°å…¬å¼å…¶å®å°±æ˜¯a==b, b==c,åˆ™a==c

å…¬å¼å¾ˆæ— èŠï¼Œèƒ½çœ‹æ˜ç™½å°±è¡Œäº†ï¼Œä¸éœ€è¦è®°ä½ã€‚

è¿™ä¸€æ®µåªæ˜¯ä¸ºäº†è¯æ˜æˆ‘ä»¬ä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥å°†`j`ç§»åŠ¨åˆ°`k`è€Œæ— é¡»å†æ¯”è¾ƒå‰é¢çš„`k`ä¸ªå­—ç¬¦ã€‚

### æ±‚è§£nextæ•°ç»„

å¥½ï¼Œæ¥ä¸‹æ¥å°±æ˜¯é‡ç‚¹äº†ï¼Œæ€ä¹ˆæ±‚è¿™ä¸ªï¼ˆè¿™äº›ï¼‰`k`å‘¢ï¼Ÿå› ä¸ºåœ¨`P`çš„æ¯ä¸€ä¸ªä½ç½®éƒ½å¯èƒ½å‘ç”Ÿä¸åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¦è®¡ç®—æ¯ä¸€ä¸ªä½ç½®`j`å¯¹åº”çš„`k`ï¼Œæ‰€ä»¥ç”¨ä¸€ä¸ªæ•°ç»„`next`æ¥ä¿å­˜ï¼Œ`next[j] = k`ï¼Œè¡¨ç¤ºå½“`T[i] != P[j]`æ—¶ï¼Œ**`j`æŒ‡é’ˆ**çš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚

å¾ˆå¤šæ•™ææˆ–åšæ–‡åœ¨è¿™ä¸ªåœ°æ–¹éƒ½æ˜¯è®²å¾—æ¯”è¾ƒå«ç³Šæˆ–æ˜¯æ ¹æœ¬å°±ä¸€ç¬”å¸¦è¿‡ï¼Œç”šè‡³å°±æ˜¯è´´ä¸€æ®µä»£ç ä¸Šæ¥ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™æ ·æ±‚ï¼Ÿæ€ä¹ˆå¯ä»¥è¿™æ ·æ±‚ï¼Ÿæ ¹æœ¬å°±æ²¡æœ‰è¯´æ¸…æ¥šã€‚è€Œè¿™é‡Œæ°æ°æ˜¯æ•´ä¸ªç®—æ³•æœ€å…³é”®çš„åœ°æ–¹ã€‚

```java
public static int[] getNext(String ps) {
    char[] p = ps.toCharArray();
    int[] next = new int[p.length];
    next[0] = -1; // ç¬¬0ä¸ªå…ƒç´ åŒ¹é…å¤±è´¥ï¼Œjä¸éœ€è¦ç§»åŠ¨ï¼Œè¦ç§»åŠ¨i
    int j = 0;
    int k = -1;
    while (j < p.length - 1) {
       if (k == -1 || p[j] == p[k]) {
            next[++j] = ++k;
       } else {
           k = next[k];
       }
    }
    return next;

}
```

> NOTE:
>
> ä¸€ã€`next[j]` è¡¨ç¤ºçš„æ˜¯ `[0:j-1]` çš„å…¬å…±å‰åç¼€çš„é•¿åº¦ï¼Œå› ä¸ºå½“`p[j]`å’Œ`t[i]`ä¸ç›¸ç­‰çš„æ—¶å€™ï¼Œæ˜¾ç„¶éœ€è¦å……åˆ†åˆ©ç”¨ç ”ç©¶åŒ¹é…éƒ¨åˆ†çš„ä¿¡æ¯ï¼Œå¯¹äºå…¬å…±å‰åç¼€éƒ¨åˆ†ï¼Œæ˜¯ä¸éœ€è¦å†æ¬¡è¿›è¡ŒåŒ¹é…çš„ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥åˆ©ç”¨çš„ã€‚
>
> å¦å¤–éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œ`next[j]`ä¿å­˜çš„æ˜¯é•¿åº¦ï¼Œæ ¹æ®é•¿åº¦å’Œä¸‹æ ‡çš„æ˜ å°„å…³ç³»ï¼Œå¦‚æœä½¿ç”¨æ­¤é•¿åº¦ä½œä¸ºä¸‹æ ‡ï¼Œæ˜¾ç„¶ä¼šåŒ¹é…åˆ°å…¬å…±å‰åç¼€çš„åä¸€ä¸ªå…ƒç´ ï¼Œè¿™æ˜¯éå¸¸ç¬¦åˆKMPç®—æ³•çš„ï¼Œå› ä¸ºå®ƒå°±æ˜¯éœ€è¦ä»è¿™ä¸ªå¼€å§‹åŒ¹é…ã€‚
> 
>    äºŒã€ä¸Šè¿°ç®—æ³•æ˜¯å…¸å‹çš„fast-slow double pointerï¼Œkå°±æ˜¯slow pointerï¼Œjå°±æ˜¯fast pointerã€‚
>    
>   ä¸æ­¤ç±»ä¼¼çš„ä½¿ç”¨fast-slow double pointeræ¥å¤„ç†arrayçš„algorithmï¼Œåœ¨ä¸‹é¢çš„æ–‡ç« ä¸­æœ‰ä»‹ç»ï¼š
>    
>    1ã€labuladong [å¦‚ä½•é«˜æ•ˆå¯¹æœ‰åºæ•°ç»„/é“¾è¡¨å»é‡ï¼Ÿ](https://mp.weixin.qq.com/s/6Eb7gKqNqXH9B0hSZvMs5A)
> 
>    2ã€labuladong  [åŒæŒ‡é’ˆæŠ€å·§ç§’æ€å››é“æ•°ç»„/é“¾è¡¨é¢˜ç›®](https://mp.weixin.qq.com/s/55UPwGL0-Vgdh8wUEPXpMQ)
>    
>    å¦å¤–éœ€è¦æ³¨æ„å¯¹ç‰¹æ®Šæƒ…å†µçš„å¤„ç†ï¼Œå½“åªæœ‰ä¸€ä¸ªå…ƒç´ çš„è¿˜æ˜¯ï¼Œå®ƒæœ‰å…¬å…±å‰ç¼€å—ï¼Ÿè¯¥ç®—æ³•æ˜¯å‡å®šæœ‰çš„
>    
>    ä¸‰ã€åˆå§‹å€¼è¯´æ˜
>    
>    ```c++
>    next[0] == -1 # åœ¨ä½ç½®0ä¸åŒ¹é…ï¼Œjä¸éœ€è¦è½¬ç§»ï¼Œéœ€è¦è½¬ç§»iï¼Œå®ƒå…¶å®ä¹Ÿè¡¨ç¤ºå®ƒæ²¡æœ‰å‰éƒ¨åˆ†
>    next[1] == 0 # åœ¨ä½ç½®1ä¸åŒ¹é…ï¼Œè½¬ç§»åˆ°0
>    ```
>    
>    

è¿™ä¸ªç‰ˆæœ¬çš„æ±‚`next`æ•°ç»„çš„ç®—æ³•åº”è¯¥æ˜¯æµä¼ æœ€å¹¿æ³›çš„ï¼Œä»£ç æ˜¯å¾ˆç®€æ´ã€‚å¯æ˜¯çœŸçš„å¾ˆè®©äººæ‘¸ä¸åˆ°å¤´è„‘ï¼Œå®ƒè¿™æ ·è®¡ç®—çš„ä¾æ®åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ

å¥½ï¼Œå…ˆæŠŠè¿™ä¸ªæ”¾ä¸€è¾¹ï¼Œæˆ‘ä»¬è‡ªå·±æ¥æ¨å¯¼æ€è·¯ï¼Œç°åœ¨è¦å§‹ç»ˆè®°ä½ä¸€ç‚¹ï¼Œ`next[j]`çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯`k`ï¼‰è¡¨ç¤ºï¼Œå½“`P[j] != T[i]`æ—¶ï¼Œ`j`æŒ‡é’ˆçš„ä¸‹ä¸€æ­¥ç§»åŠ¨ä½ç½®ã€‚

#### å½“`j`ä¸º0æ—¶

å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªï¼šå½“`j`ä¸º0æ—¶ï¼Œå¦‚æœè¿™æ—¶å€™ä¸åŒ¹é…ï¼Œæ€ä¹ˆåŠï¼Ÿ

![img](https://images0.cnblogs.com/blog/416010/201308/17084258-efd2e95d3644427ebc0304ed3d7adefb.png)

åƒä¸Šå›¾è¿™ç§æƒ…å†µï¼Œ`j`å·²ç»åœ¨æœ€å·¦è¾¹äº†ï¼Œä¸å¯èƒ½å†ç§»åŠ¨äº†ï¼Œè¿™æ—¶å€™è¦åº”è¯¥æ˜¯`i`æŒ‡é’ˆåç§»ã€‚æ‰€ä»¥åœ¨ä»£ç ä¸­æ‰ä¼šæœ‰`next[0] = -1;`è¿™ä¸ªåˆå§‹åŒ–ã€‚

> NOTE: 
>
> ä¸€ã€çœ‹äº†ä¸‹é¢çš„å®Œæ•´çš„ä»£ç å°±çŸ¥é“ä¸ºä»€ä¹ˆä½¿ç”¨`-1`æ¥ä½œä¸ºåˆå§‹å€¼ï¼Œå› ä¸º`++k`å’Œ`++j`æ˜¯åœ¨ç›¸åŒçš„åˆ†æ”¯ä¸­ï¼Œ`++j`å `j` ä¸º0ï¼Œè¿™å°±ä¿è¯äº†ä»Pçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹åŒ¹é…ã€‚

#### å½“`j`ä¸º1æ—¶

å¦‚æœæ˜¯å½“`j`ä¸º1çš„æ—¶å€™å‘¢ï¼Ÿ

 ![img](https://images0.cnblogs.com/blog/416010/201308/17084310-29f9f8dbb6034151a383e7ccf6f5583e.png)

æ˜¾ç„¶ï¼Œ`j`æŒ‡é’ˆä¸€å®šæ˜¯åç§»åˆ°0ä½ç½®çš„ã€‚å› ä¸ºå®ƒå‰é¢ä¹Ÿå°±åªæœ‰è¿™ä¸€ä¸ªä½ç½®äº†ã€‚

#### å½“`P[k] == P[j]`æ—¶

ä¸‹é¢è¿™ä¸ªæ˜¯æœ€é‡è¦çš„ï¼Œè¯·çœ‹å¦‚ä¸‹å›¾ï¼š

![img](https://images0.cnblogs.com/blog/416010/201308/17084327-8a3cdfab03094bfa9e5cace26796cae5.png) 

![img](https://images0.cnblogs.com/blog/416010/201308/17084342-616036472ab546c082aa991004bb0034.png)



è¯·ä»”ç»†å¯¹æ¯”è¿™ä¸¤ä¸ªå›¾ã€‚

æˆ‘ä»¬å‘ç°ä¸€ä¸ªè§„å¾‹ï¼š

å½“`P[k] == P[j]`æ—¶ï¼Œæœ‰`next[j+1] == next[j] + 1`

> NOTE: 
>
> é€’å½’å‡½æ•°



å…¶å®è¿™ä¸ªæ˜¯å¯ä»¥è¯æ˜çš„ï¼š

å› ä¸ºåœ¨`P[j]`ä¹‹å‰å·²ç»æœ‰`P[0 ~ k-1] == p[j-k ~ j-1]`ã€‚ï¼ˆ`next[j] == k`ï¼‰

è¿™æ—¶å€™ç°æœ‰`P[k] == P[j]`ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥å¾—åˆ°`P[0 ~ k-1] + P[k] == p[j-k ~ j-1] + P[j]`ã€‚

å³ï¼š`P[0 ~ k] == P[j-k ~ j]`ï¼Œå³`next[j+1] == k + 1 == next[j] + 1`ã€‚

è¿™é‡Œçš„å…¬å¼ä¸æ˜¯å¾ˆå¥½æ‡‚ï¼Œè¿˜æ˜¯çœ‹å›¾ä¼šå®¹æ˜“ç†è§£äº›ã€‚

#### å½“`P[k] != P[j]`æ—¶,

å½“`P[k] != P[j]`æ—¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![img](https://images0.cnblogs.com/blog/416010/201308/17122358-fd7e52dd382c4268a8ff52b85bff465d.png) 



åƒè¿™ç§æƒ…å†µï¼Œå¦‚æœä½ ä»ä»£ç ä¸Šçœ‹åº”è¯¥æ˜¯è¿™ä¸€å¥ï¼š`k = next[k];`ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·å­ï¼Ÿä½ çœ‹ä¸‹é¢åº”è¯¥å°±æ˜ç™½äº†ã€‚

 ![img](https://images0.cnblogs.com/blog/416010/201308/17122439-e349fed25e974e7886a27d18871ae48a.png)

ç°åœ¨ä½ åº”è¯¥çŸ¥é“ä¸ºä»€ä¹ˆè¦`k = next[k]`äº†å§ï¼åƒä¸Šè¾¹çš„ä¾‹å­ï¼Œæˆ‘ä»¬å·²ç»ä¸å¯èƒ½æ‰¾åˆ°`[ Aï¼ŒBï¼ŒAï¼ŒB ]`è¿™ä¸ªæœ€é•¿çš„åç¼€ä¸²äº†ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯å¯èƒ½æ‰¾åˆ°`[ Aï¼ŒB ]`ã€`[ B ]`è¿™æ ·çš„å‰ç¼€ä¸²çš„ã€‚æ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹åƒä¸åƒåœ¨å®šä½`[ Aï¼ŒBï¼ŒAï¼ŒC ]`è¿™ä¸ªä¸²ï¼Œå½“`C`å’Œä¸»ä¸²ä¸ä¸€æ ·äº†ï¼ˆä¹Ÿå°±æ˜¯`k`ä½ç½®ä¸ä¸€æ ·äº†ï¼‰ï¼Œé‚£å½“ç„¶æ˜¯æŠŠæŒ‡é’ˆç§»åŠ¨åˆ°`next[k]`å•¦ã€‚

> NOTE: è¿™ç¯‡æ–‡ç« è¿™é‡Œçš„åˆ†æè¿˜æ˜¯æ¯”è¾ƒéš¾ä»¥ç†è§£çš„ï¼Œä¸‹ä¸€ç¯‡åœ¨åˆ†ææ›´åŠ é€å½»ã€‚

> NOTE: æ„å»º`next`æ•°ç»„çš„ç®—æ³•æ˜¯ä½¿ç”¨çš„æ•°å­¦å½’çº³æ³•æ¥æ±‚è§£nextæ•°ç»„çš„æ¯ä¸ªå€¼ï¼Œå³æ ¹æ®`next`æ•°ç»„ä¸­å‰`j`ä¸ªå…ƒç´ çš„å€¼æ¥æ±‚è§£`next[j+1]`çš„å€¼ã€‚

### KMPç®—æ³•

æœ‰äº†`next`æ•°ç»„ä¹‹åå°±ä¸€åˆ‡å¥½åŠäº†ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ‰‹å†™KMPç®—æ³•äº†ï¼š

```java
public static int KMP(String ts, String ps) {
    char[] t = ts.toCharArray();
    char[] p = ps.toCharArray();
  
    int i = 0; // ä¸»ä¸²çš„ä½ç½®
    int j = 0; // æ¨¡å¼ä¸²çš„ä½ç½®

    int[] next = getNext(ps);

    while (i < t.length && j < p.length) {
       if (j == -1 || t[i] == p[j]) { // å½“jä¸º-1æ—¶ï¼Œè¦ç§»åŠ¨çš„æ˜¯iï¼Œå½“ç„¶jä¹Ÿè¦å½’0
           i++;
           j++;
       } else {
           // iä¸éœ€è¦å›æº¯äº†
           // i = i - j + 1;
           j = next[j]; // jå›åˆ°æŒ‡å®šä½ç½®
       }
    }
    if (j == p.length) {
       return i - j;
    } else {
       return -1;
    }

}
```

å’Œæš´åŠ›ç ´è§£ç›¸æ¯”ï¼Œå°±æ”¹åŠ¨äº†4ä¸ªåœ°æ–¹ã€‚å…¶ä¸­æœ€ä¸»è¦çš„ä¸€ç‚¹å°±æ˜¯ï¼Œ`i`ä¸éœ€è¦å›æº¯äº†ã€‚

æœ€åï¼Œæ¥çœ‹ä¸€ä¸‹ä¸Šè¾¹çš„ç®—æ³•å­˜åœ¨çš„ç¼ºé™·ã€‚æ¥çœ‹ç¬¬ä¸€ä¸ªä¾‹å­ï¼š

![img](https://images0.cnblogs.com/blog/416010/201308/17084712-f0d6998938764b309f61923452a2b20f.png) 

æ˜¾ç„¶ï¼Œå½“æˆ‘ä»¬ä¸Šè¾¹çš„ç®—æ³•å¾—åˆ°çš„`next`æ•°ç»„åº”è¯¥æ˜¯`[ -1ï¼Œ0ï¼Œ0ï¼Œ1 ]`

æ‰€ä»¥ä¸‹ä¸€æ­¥æˆ‘ä»¬åº”è¯¥æ˜¯æŠŠ`j`ç§»åŠ¨åˆ°ç¬¬1ä¸ªå…ƒç´ å’¯ï¼š

 ![img](https://images0.cnblogs.com/blog/416010/201308/17084726-790fc1b2c48c411b8011eab9de692f6d.png)

ä¸éš¾å‘ç°ï¼Œ**è¿™ä¸€æ­¥æ˜¯å®Œå…¨æ²¡æœ‰æ„ä¹‰çš„ã€‚å› ä¸ºåé¢çš„`B`å·²ç»ä¸åŒ¹é…äº†ï¼Œé‚£å‰é¢çš„`B`ä¹Ÿä¸€å®šæ˜¯ä¸åŒ¹é…çš„**ï¼ŒåŒæ ·çš„æƒ…å†µå…¶å®è¿˜å‘ç”Ÿåœ¨ç¬¬2ä¸ªå…ƒç´ `A`ä¸Šã€‚

æ˜¾ç„¶ï¼Œ**å‘ç”Ÿé—®é¢˜çš„åŸå› åœ¨äº`P[j] == P[next[j]]`**ã€‚

æ‰€ä»¥æˆ‘ä»¬ä¹Ÿåªéœ€è¦æ·»åŠ ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶å³å¯ï¼š

```java
public static int[] getNext(String ps) {

    char[] p = ps.toCharArray();

    int[] next = new int[p.length];

    next[0] = -1;

    int j = 0;

    int k = -1;

    while (j < p.length - 1) {

       if (k == -1 || p[j] == p[k]) {

           if (p[++j] == p[++k]) { // å½“ä¸¤ä¸ªå­—ç¬¦ç›¸ç­‰æ—¶è¦è·³è¿‡

              next[j] = next[k];

           } else {

              next[j] = k;

           }

       } else {

           k = next[k];

       }

    }

    return next;

}
```



è¯¥ç®—æ³•çš„å®ç°æ˜¯éå¸¸ç±»ä¼¼äºåŠ¨æ€è§„åˆ’ç®—æ³•çš„

`next[j]`çš„å€¼`k`å°±æ˜¯`j`ä½ä¹‹å‰çš„å­ä¸²ä¸­ï¼Œå‰ç¼€é›†å’Œåç¼€é›†ä¸­çš„æœ€å¤§é‡å¤å­ä¸²çš„é•¿åº¦ã€‚

`abacabac`

|        |             |              | next[0]=-1;j=0;k=-1 |
| ------ | ----------- | ------------ | ------------------- |
| æ¡ä»¶1  | æ¡ä»¶2       | åˆ†æ”¯2        | åˆ†æ”¯1               |
| k==-1  |             |              | next[1]=0;j=1;k=0   |
|        | p[1]!=p[0]; | k=next[0]=-1 |                     |
| k==-1  |             |              | next[2]=0;j=2;k=0   |
|        | p[2]==p[0]; |              | next[3]=1;j=3;k=1   |
|        | p[3]!=p[1]; | k=next[1]=0  |                     |
|        | p[3]!=p[0]; | k=next[0]=-1 |                     |
| k==-1; |             |              | next[4]=0;j=4;k=0   |
|        | p[4]==p[0]  |              | next[5]=1;j=5;k=1   |
|        | p[5]==p[1]  |              | next[6]=2;j=6;k=2   |
|        | p[6]==p[2]  |              | next[7]=3;j=7;k=3   |
|        | p[7]==p[3]  |              | next[8]=4;j=8;k=4   |

è¦æƒ³å¾—åˆ°`p[j+1]`ï¼Œåªéœ€è¦æ¯”è¾ƒ`p[j]`å’Œ`p[k]`å³å¯ï¼›





## wikipedia [Knuthâ€“Morrisâ€“Pratt algorithm](https://en.wikipedia.org/wiki/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm)

In [computer science](https://en.wikipedia.org/wiki/Computer_science), the **Knuthâ€“Morrisâ€“Pratt [string-searching algorithm](https://en.wikipedia.org/wiki/String-searching_algorithm)** (or **KMP algorithm**) searches for occurrences of a "word" `W` within a main "text string" `S` by employing the observation that when a mismatch occurs, the word itself embodies sufficient information to determine where the next match could begin, thus bypassing re-examination of previously matched characters.

The [algorithm](https://en.wikipedia.org/wiki/Algorithm) was conceived by [James H. Morris](https://en.wikipedia.org/wiki/James_H._Morris) and independently discovered by [Donald Knuth](https://en.wikipedia.org/wiki/Donald_Knuth) "a few weeks later" from [automata theory](https://en.wikipedia.org/wiki/Automata_theory).[[1\]](https://en.wikipedia.org/wiki/Knuthâ€“Morrisâ€“Pratt_algorithm#cite_note-knuth1977-2)[[2\]](https://en.wikipedia.org/wiki/Knuthâ€“Morrisâ€“Pratt_algorithm#cite_note-3) Morris and [Vaughan Pratt](https://en.wikipedia.org/wiki/Vaughan_Pratt) published a technical report in 1970.[[3\]](https://en.wikipedia.org/wiki/Knuthâ€“Morrisâ€“Pratt_algorithm#cite_note-4) The three also published the algorithm jointly in 1977.[[1\]](https://en.wikipedia.org/wiki/Knuthâ€“Morrisâ€“Pratt_algorithm#cite_note-knuth1977-2) Independently, in 1969, [Matiyasevich](https://en.wikipedia.org/wiki/Yuri_Matiyasevich)[[4\]](https://en.wikipedia.org/wiki/Knuthâ€“Morrisâ€“Pratt_algorithm#cite_note-5)[[5\]](https://en.wikipedia.org/wiki/Knuthâ€“Morrisâ€“Pratt_algorithm#cite_note-6) discovered a similar algorithm, coded by a two-dimensional Turing machine, while studying a string-pattern-matching recognition problem over a binary alphabet. This was the first linear-time algorithm for string matching.[[6\]](https://en.wikipedia.org/wiki/Knuthâ€“Morrisâ€“Pratt_algorithm#cite_note-7)



## KMP in leetcode

æ±‡æ€»æ•´ç†ç´ æ:

1ã€[LeetCode-ã€ å­—ç¬¦ä¸²å“ˆå¸Œã€KMP ã€æŒæ¡æ¨¡æ¿ï¼Œå¿«ä¹å…¶å®å¾ˆç®€å• ğŸ¤£](https://leetcode.cn/problems/longest-happy-prefix/solution/by-flix-k4p3/) 

|                                                              |                                                              |      |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ---- |
| [LeetCode-28. å®ç° strStr()-ç®€å•](https://leetcode.cn/problems/implement-strstr/) |                                                              |      |
| [LeetCode-214. æœ€çŸ­å›æ–‡ä¸²-å›°éš¾](https://leetcode.cn/problems/shortest-palindrome/) | https://leetcode.com/problems/shortest-palindrome/discuss/60113/clean-kmp-solution-with-super-detailed-explanation |      |
| [LeetCode-1392. æœ€é•¿å¿«ä¹å‰ç¼€](https://leetcode.cn/problems/longest-happy-prefix/) | https://leetcode.com/problems/longest-happy-prefix/discuss/549465/kmp-algorithm |      |
| [LeetCode-1910. åˆ é™¤ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ‰€æœ‰å‡ºç°çš„ç»™å®šå­å­—ç¬¦ä¸²](https://leetcode.cn/problems/remove-all-occurrences-of-a-substring/) | https://leetcode.com/problems/remove-all-occurrences-of-a-substring/discuss/1299275/True-O(n-%2B-m)-KMP/989600/ |      |
|                                                              |                                                              |      |